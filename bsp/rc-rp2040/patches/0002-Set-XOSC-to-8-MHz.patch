From 7ab815a16c9536f5d19495ec9195978e2af0f7d2 Mon Sep 17 00:00:00 2001
From: Victor-Stefan Jach <14238510+vjach@users.noreply.github.com>
Date: Fri, 6 Jan 2023 16:47:32 +0100
Subject: [PATCH] Set XOSC to 8 MHz

Signed-off-by: Victor-Stefan Jach <14238510+vjach@users.noreply.github.com>
---
 src/host/pico_platform/include/hardware/platform_defs.h   | 2 +-
 src/rp2040/hardware_regs/include/hardware/platform_defs.h | 2 +-
 src/rp2_common/hardware_clocks/clocks.c                   | 6 +++---
 3 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/src/host/pico_platform/include/hardware/platform_defs.h b/src/host/pico_platform/include/hardware/platform_defs.h
index 6d0aa84..6f87c00 100644
--- a/src/host/pico_platform/include/hardware/platform_defs.h
+++ b/src/host/pico_platform/include/hardware/platform_defs.h
@@ -17,7 +17,7 @@
 
 #define NUM_SPIN_LOCKS 32u
 
-#define XOSC_MHZ 12
+#define XOSC_MHZ 8
 
 #define NUM_SPIN_LOCKS 32u
 
diff --git a/src/rp2040/hardware_regs/include/hardware/platform_defs.h b/src/rp2040/hardware_regs/include/hardware/platform_defs.h
index 21f77ca..5cacb05 100644
--- a/src/rp2040/hardware_regs/include/hardware/platform_defs.h
+++ b/src/rp2040/hardware_regs/include/hardware/platform_defs.h
@@ -39,7 +39,7 @@
 
 // PICO_CONFIG: XOSC_MHZ, The crystal oscillator frequency in Mhz, type=int, default=12, advanced=true, group=hardware_base
 #ifndef XOSC_MHZ
-#define XOSC_MHZ _u(12)
+#define XOSC_MHZ _u(8)
 #endif
 
 #endif
diff --git a/src/rp2_common/hardware_clocks/clocks.c b/src/rp2_common/hardware_clocks/clocks.c
index 9ba51f0..39d68ed 100644
--- a/src/rp2_common/hardware_clocks/clocks.c
+++ b/src/rp2_common/hardware_clocks/clocks.c
@@ -153,7 +153,7 @@ void clocks_init(void) {
     /// \end::pll_settings[]
 
     /// \tag::pll_init[]
-    pll_init(pll_sys, 1, 1500 * MHZ, 6, 2);
+    pll_init(pll_sys, 1, 1000 * MHZ, 4, 2);
     pll_init(pll_usb, 1, 1200 * MHZ, 5, 5);
     /// \end::pll_init[]
 
@@ -162,8 +162,8 @@ void clocks_init(void) {
     clock_configure(clk_ref,
                     CLOCKS_CLK_REF_CTRL_SRC_VALUE_XOSC_CLKSRC,
                     0, // No aux mux
-                    12 * MHZ,
-                    12 * MHZ);
+                    8 * MHZ,
+                    8 * MHZ);
 
     /// \tag::configure_clk_sys[]
     // CLK SYS = PLL SYS (125MHz) / 1 = 125MHz
-- 
2.25.1

